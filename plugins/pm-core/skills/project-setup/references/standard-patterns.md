# Standard Patterns

Patterns for generated commands and scripts. Load this for consistent behavior across all generated artifacts.

## Preflight Checklist

Every generated command includes preflight validation. Silent â€” do not report progress to user. Just check and proceed or fail fast.

1. **Input validation** â€” arguments present, correct format
2. **Environment check** â€” required tools available, auth verified
3. **State check** â€” required files exist (`.claude/pm/config.yaml`, etc.)
4. **Datetime capture** â€” `current_dt=$(date -u +"%Y-%m-%dT%H:%M:%SZ")`

## Error Format

Standardized messages:
- `âŒ {What failed}: {How to fix}`
- `âš ï¸ {Warning}: {What to consider}`
- `âœ… {What succeeded}`

Example: `âŒ gh not authenticated: Run gh auth login`

## Output Format

Commands end with structured summary:

    âœ… {Action completed}

    ðŸ“Š Summary:
       Key1: Value1
       Key2: Value2

    ðŸ”— Next: {suggested next command}

## Generated File Header

All files generated by pm-core start with:

    # Generated by pm-core v{version} on {date}
    # Source template: {template_name}
    # Modify freely â€” /pm:upgrade will detect changes and ask before overwriting

## Datetime

Always use ISO 8601 UTC: `date -u +"%Y-%m-%dT%H:%M:%SZ"`
Never use placeholder dates. Capture in variable before use.

## Frontmatter Stripping

Before posting markdown content to GitHub issues:

    # Strip YAML frontmatter (everything between first two --- lines)
    body=$(sed '1{/^---$/!q;};1,/^---$/d' "$file")

Preserve frontmatter locally â€” only strip for external publishing.

## Repository Protection

Before any GitHub write operation, verify remote is configured:

    remote_url=$(git remote get-url origin 2>/dev/null || echo "")
    if [ -z "$remote_url" ]; then
      echo "âŒ No remote origin configured"
      exit 1
    fi

## Default Branch Detection

Never hardcode branch names. Detect dynamically:

    default_branch=$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')
    if [ -z "$default_branch" ]; then
      default_branch=$(git branch -l main master develop 2>/dev/null | head -1 | tr -d ' *')
    fi
    : "${default_branch:=main}"  # Final fallback
