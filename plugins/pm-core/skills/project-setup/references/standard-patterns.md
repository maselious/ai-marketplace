# Standard Patterns

Patterns for generated commands and scripts. Load this for consistent behavior across all generated artifacts.

## Preflight Checklist

Every generated command includes preflight validation. Silent ‚Äî do not report progress to user. Just check and proceed or fail fast.

1. **Input validation** ‚Äî arguments present, correct format
2. **Environment check** ‚Äî required tools available, auth verified
3. **State check** ‚Äî required files exist (`.claude/pm/config.yaml`, etc.)
4. **Datetime capture** ‚Äî `current_dt=$(date -u +"%Y-%m-%dT%H:%M:%SZ")`

## Error Format

Standardized messages:
- `‚ùå {What failed}: {How to fix}`
- `‚ö†Ô∏è {Warning}: {What to consider}`
- `‚úÖ {What succeeded}`

Example: `‚ùå gh not authenticated: Run gh auth login`

## Output Format

Commands end with structured summary:

    ‚úÖ {Action completed}

    üìä Summary:
       Key1: Value1
       Key2: Value2

    üîó Next: {suggested next command}

## Generated File Header

All files generated by pm-core start with:

    # Generated by pm-core v{version} on {date}
    # Source template: {template_name}
    # Modify freely ‚Äî /pm:upgrade will detect changes and ask before overwriting

## Datetime

Always use ISO 8601 UTC: `date -u +"%Y-%m-%dT%H:%M:%SZ"`
Never use placeholder dates. Capture in variable before use.

## Frontmatter Stripping

Before posting markdown content to GitHub issues:

    # Strip YAML frontmatter (everything between first two --- lines)
    body=$(sed '1{/^---$/!q;};1,/^---$/d' "$file")

Preserve frontmatter locally ‚Äî only strip for external publishing.

## Repository Protection

Before any GitHub write operation, check remote:

    remote_url=$(git remote get-url origin 2>/dev/null || echo "")
    if [[ "$remote_url" == *"maselious/ai-marketplace"* ]]; then
      echo "‚ùå Cannot sync to plugin marketplace repository"
      exit 1
    fi
