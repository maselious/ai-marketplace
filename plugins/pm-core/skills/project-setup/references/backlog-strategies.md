# Backlog Strategies

Instructions for setting up task tracking during Gate 3.

## BACKLOG.md Template

Always available, no external dependencies. Generate at `.claude/pm/BACKLOG.md`:

    # Project Backlog

    ## Active
    <!-- Current work items -->

    ## Ready
    <!-- Prioritized items ready to start -->

    ## Blocked
    <!-- Items waiting on dependencies -->

    ## Done
    <!-- Recently completed (last 10) -->

## GitHub Integration (Built-in)

### Discovery

    # Check gh CLI available
    which gh || echo "‚ùå gh not found: https://cli.github.com"

    # Check auth
    gh auth status || echo "‚ùå Not authenticated: gh auth login"

    # Check repo access
    gh repo view --json name,owner,url || echo "‚ùå No repo access"

### Label Setup

    gh label create "pm:epic" --color "0052CC" --description "Epic-level task" 2>/dev/null || true
    gh label create "pm:task" --color "1D76DB" --description "Individual task" 2>/dev/null || true
    gh label create "pm:in-progress" --color "FBCA04" --description "In progress" 2>/dev/null || true
    gh label create "pm:blocked" --color "D93F0B" --description "Blocked" 2>/dev/null || true

### Capabilities After Setup

| Stage | Method | Command |
|-------|--------|---------|
| Sync | `gh issue comment` | `scripts/pm-sync.sh` |
| Status | `gh issue list` | inline in `commands/pm-status.md` |
| Next | `gh issue list --label` | inline in `commands/pm-next.md` |
| Standup | `gh issue list --since` | inline in `commands/pm-standup.md` |
| Close | `gh issue close` | `scripts/pm-close.sh` |

## Tech/Business Split

If user separates technical and business tasks:
- Technical ‚Üí GitHub Issues (default) or BACKLOG.md
- Business ‚Üí ask user for tool (Notion, Linear, etc.)
- External tools: check MCP servers, CLIs. If nothing found ‚Üí BACKLOG.md fallback

## Script Templates

### pm-sync.sh

    #!/usr/bin/env bash
    set -euo pipefail
    # pm-sync.sh ‚Äî Sync local progress to GitHub Issues
    # Generated by pm-core v{version} on {date}

    ISSUE="${1:?Usage: pm-sync.sh <issue_number>}"

    # Preflight
    gh auth status >/dev/null 2>&1 || { echo "‚ùå gh not authenticated"; exit 1; }

    # Check remote protection
    remote_url=$(git remote get-url origin 2>/dev/null || echo "")
    if [[ "$remote_url" == *"maselious/ai-marketplace"* ]]; then
      echo "‚ùå Cannot sync to plugin marketplace repo"; exit 1
    fi

    # Build progress body
    STATE=".claude/pm/current-epic/state.yaml"
    if [ -f "$STATE" ]; then
      BODY=$(sed '1{/^---$/!q;};1,/^---$/d' "$STATE")
    else
      BODY="Progress update from local development."
    fi

    gh issue comment "$ISSUE" --body "$BODY"
    echo "‚úÖ Synced to issue #$ISSUE"

### pm-close.sh

    #!/usr/bin/env bash
    set -euo pipefail
    # pm-close.sh ‚Äî Close issue and clean up labels
    # Generated by pm-core v{version} on {date}

    ISSUE="${1:?Usage: pm-close.sh <issue_number>}"

    gh auth status >/dev/null 2>&1 || { echo "‚ùå gh not authenticated"; exit 1; }
    gh issue close "$ISSUE"
    gh issue edit "$ISSUE" --remove-label "pm:in-progress" 2>/dev/null || true
    echo "‚úÖ Closed issue #$ISSUE"

### test-setup.sh

    #!/usr/bin/env bash
    set -euo pipefail
    # test-setup.sh ‚Äî Verify pm-core generated setup
    # Generated by pm-core v{version} on {date}

    echo "üß™ pm-core Setup Verification"
    echo "=============================="
    PASS=0; FAIL=0

    check() {
      if eval "$1" >/dev/null 2>&1; then
        echo "  ‚úÖ $2"; ((PASS++))
      else
        echo "  ‚ùå $2"; ((FAIL++))
      fi
    }

    echo ""; echo "Platform:"
    check "bash --version" "bash available"
    check "git --version" "git available"

    echo ""; echo "Scripts:"
    for s in .claude/scripts/*.sh; do
      [ -f "$s" ] || continue
      name=$(basename "$s")
      check "test -x '$s'" "$name executable"
      check "bash -n '$s'" "$name syntax"
      check "! file '$s' | grep -q CRLF" "$name line endings"
    done

    echo ""; echo "=============================="
    echo "Results: $PASS passed, $FAIL failed"
    [ "$FAIL" -eq 0 ] && echo "‚úÖ All passed" || echo "‚ùå $FAIL checks failed"
    exit "$FAIL"

## Generated Command Templates

### pm-sync.md (delegates to script)

    ---
    name: pm-sync
    description: Sync local progress to GitHub Issues
    argument-hint: "<issue_number>"
    ---

    Sync current work progress to a GitHub issue as a comment.

    Run: `.claude/scripts/pm-sync.sh $ARGUMENTS`

    If script not found, tell user: "‚ùå pm-sync.sh not found. Re-run /pm:setup"

### pm-status.md (inline)

    ---
    name: pm-status
    description: Show current project management state
    ---

    Read and display:
    1. `.claude/pm/config.yaml` ‚Äî active integrations
    2. `.claude/pm/current-epic/state.yaml` ‚Äî current work (if exists)
    3. Recent GitHub issues: `gh issue list --label "pm:in-progress" --limit 5`

    Format as structured summary.

### pm-close.md (delegates to script)

    ---
    name: pm-close
    description: Close a task or epic
    argument-hint: "<issue_number>"
    ---

    Close a GitHub issue and clean up labels.

    Run: `.claude/scripts/pm-close.sh $ARGUMENTS`
